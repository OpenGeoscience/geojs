<!DOCTYPE html>

<html>
<head>
  <title>main.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>main.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-1">&#x00a7;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/* globals utils */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-2">&#x00a7;</a>
              </div>
              <p>Run after the DOM loads</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>$(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
  <span class="hljs-string">&#x27;use strict&#x27;</span>;

  <span class="hljs-keyword">var</span> map, layer, feature, ui, save, infoData = <span class="hljs-literal">null</span>, canvas;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-3">&#x00a7;</a>
              </div>
              <p>Get query parameters
scale: false – turn off category scale and colorng
width: speed – width is proportional to speed
opacity: false – don’t make lower categories somewhat transparent
smooth: true – round corners of line angles
hover: false – don’t show specific hurricane on hover
x, y, zoom</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> query = utils.<span class="hljs-title function_">getQuery</span>();

  <span class="hljs-keyword">var</span> cscale = d3.<span class="hljs-title function_">scaleOrdinal</span>()
    .<span class="hljs-title function_">range</span>([
      <span class="hljs-string">&#x27;#7f7f7f&#x27;</span>,
      <span class="hljs-string">&#x27;#d62728&#x27;</span>,
      <span class="hljs-string">&#x27;#ff7f0e&#x27;</span>,
      <span class="hljs-string">&#x27;#bcbd22&#x27;</span>,
      <span class="hljs-string">&#x27;#9467bd&#x27;</span>,
      <span class="hljs-string">&#x27;#17becf&#x27;</span>
    ])
    .<span class="hljs-title function_">domain</span>([
      <span class="hljs-number">0</span>,
      <span class="hljs-number">5</span>,
      <span class="hljs-number">4</span>,
      <span class="hljs-number">3</span>,
      <span class="hljs-number">2</span>,
      <span class="hljs-number">1</span>
    ]);

  <span class="hljs-keyword">var</span> start = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">&#x27;1980-01-01&#x27;</span>);
  <span class="hljs-keyword">var</span> drange = (<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">&#x27;2015-01-01&#x27;</span>) - start);

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">any</span>(<span class="hljs-params">a, f</span>) {
    <span class="hljs-keyword">var</span> v = <span class="hljs-literal">false</span>;
    a.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) {
      v = v || <span class="hljs-title function_">f</span>(d);
    });
    <span class="hljs-keyword">return</span> v;
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">all</span>(<span class="hljs-params">a, f</span>) {
    <span class="hljs-keyword">var</span> v = <span class="hljs-literal">true</span>;
    a.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) {
      v = v &amp;&amp; <span class="hljs-title function_">f</span>(d);
    });
    <span class="hljs-keyword">return</span> v;
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">category</span>(<span class="hljs-params">d</span>) {
    <span class="hljs-keyword">var</span> p = d;
    <span class="hljs-keyword">if</span> (p &lt;= <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>; <span class="hljs-comment">// invalid data</span>
    }
    <span class="hljs-keyword">if</span> (p &lt; <span class="hljs-number">920</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">5</span>;
    }
    <span class="hljs-keyword">if</span> (p &lt;= <span class="hljs-number">944</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">4</span>;
    }
    <span class="hljs-keyword">if</span> (p &lt;= <span class="hljs-number">964</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">3</span>;
    }
    <span class="hljs-keyword">if</span> (p &lt;= <span class="hljs-number">979</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;
    }
    <span class="hljs-keyword">if</span> (p &gt;= <span class="hljs-number">980</span> &amp;&amp; p &lt;= <span class="hljs-number">994</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">makeInfoBox</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-keyword">if</span> (data) {
      infoData = data;
    } <span class="hljs-keyword">else</span> {
      data = infoData;
    }
    <span class="hljs-keyword">if</span> (!data) {
      <span class="hljs-keyword">return</span>;
    }

    canvas = d3.<span class="hljs-title function_">select</span>(ui.<span class="hljs-title function_">canvas</span>()).<span class="hljs-title function_">select</span>(<span class="hljs-string">&#x27;svg.dynamic-content&#x27;</span>)
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;width&#x27;</span>, $(<span class="hljs-variable language_">window</span>).<span class="hljs-title function_">width</span>())
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;height&#x27;</span>, $(<span class="hljs-variable language_">window</span>).<span class="hljs-title function_">height</span>());

    canvas.<span class="hljs-title function_">selectAll</span>(<span class="hljs-string">&#x27;.app-info-box&#x27;</span>).<span class="hljs-title function_">remove</span>();
    <span class="hljs-keyword">var</span> width = <span class="hljs-number">300</span>, height = <span class="hljs-number">600</span>;
    <span class="hljs-keyword">var</span> mapWidth = map.<span class="hljs-title function_">node</span>().<span class="hljs-title function_">width</span>();
    <span class="hljs-keyword">var</span> mapHeight = map.<span class="hljs-title function_">node</span>().<span class="hljs-title function_">height</span>();

    <span class="hljs-keyword">var</span> group = canvas.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;g&#x27;</span>).<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;class&#x27;</span>, <span class="hljs-string">&#x27;app-info-box&#x27;</span>);

    group.<span class="hljs-title function_">attr</span>(
      <span class="hljs-string">&#x27;transform&#x27;</span>,
      <span class="hljs-string">&#x27;translate(&#x27;</span> + [mapWidth - width - <span class="hljs-number">35</span>, mapHeight - height + <span class="hljs-number">10</span>] + <span class="hljs-string">&#x27;)&#x27;</span>
    );

    <span class="hljs-keyword">var</span> name = data.<span class="hljs-property">name</span>.<span class="hljs-title function_">toLowerCase</span>();
    <span class="hljs-keyword">var</span> year = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(data.<span class="hljs-property">time</span>[<span class="hljs-number">0</span>]).<span class="hljs-title function_">getFullYear</span>();
    name = name[<span class="hljs-number">0</span>].<span class="hljs-title function_">toUpperCase</span>() + name.<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>);

    group.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;rect&#x27;</span>)
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;class&#x27;</span>, <span class="hljs-string">&#x27;app-background&#x27;</span>)
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;rx&#x27;</span>, <span class="hljs-number">5</span>)
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;ry&#x27;</span>, <span class="hljs-number">5</span>)
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;y&#x27;</span>, <span class="hljs-string">&#x27;-3.3em&#x27;</span>)
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;width&#x27;</span>, width + <span class="hljs-number">20</span>)
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;height&#x27;</span>, <span class="hljs-string">&#x27;2em&#x27;</span>);

    group.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;text&#x27;</span>)
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;x&#x27;</span>, width / <span class="hljs-number">2</span>)
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;y&#x27;</span>, <span class="hljs-string">&#x27;-2em&#x27;</span>)
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;text-anchor&#x27;</span>, <span class="hljs-string">&#x27;middle&#x27;</span>)
      .<span class="hljs-title function_">text</span>(<span class="hljs-string">&#x27;Hurricane &#x27;</span> + name + <span class="hljs-string">&#x27; of &#x27;</span> + year)
      .<span class="hljs-title function_">style</span>(<span class="hljs-string">&#x27;font&#x27;</span>, <span class="hljs-string">&#x27;20px&#x27;</span>);

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">makePlot</span>(<span class="hljs-params">d</span>) {
      <span class="hljs-keyword">var</span> group = d3.<span class="hljs-title function_">select</span>(<span class="hljs-variable language_">this</span>);
      <span class="hljs-keyword">var</span> t, f, i;

      <span class="hljs-keyword">if</span> (d === <span class="hljs-number">0</span>) {
        i = <span class="hljs-string">&#x27;wind&#x27;</span>;
        t = <span class="hljs-string">&#x27;Wind speed&#x27;</span>;
        f = <span class="hljs-keyword">function</span> (<span class="hljs-params">d, j</span>) { <span class="hljs-keyword">return</span> data[i][j]; };
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (d === <span class="hljs-number">1</span>) {
        i = <span class="hljs-string">&#x27;pressure&#x27;</span>;
        t = <span class="hljs-string">&#x27;Surface pressure&#x27;</span>;
        f = <span class="hljs-keyword">function</span> (<span class="hljs-params">d, j</span>) { <span class="hljs-keyword">return</span> data[i][j]; };
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (d === <span class="hljs-number">2</span>) {
        i = <span class="hljs-string">&#x27;pressure&#x27;</span>;
        t = <span class="hljs-string">&#x27;Category&#x27;</span>;
        f = <span class="hljs-keyword">function</span> (<span class="hljs-params">d, j</span>) { <span class="hljs-keyword">return</span> <span class="hljs-title function_">category</span>(data[i][j]); };
      }

      group.<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;transform&#x27;</span>, <span class="hljs-string">&#x27;translate(0,&#x27;</span> + (d * height / <span class="hljs-number">3</span>) + <span class="hljs-string">&#x27;)&#x27;</span>);

      group.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;rect&#x27;</span>)
        .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;class&#x27;</span>, <span class="hljs-string">&#x27;app-background&#x27;</span>)
        .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;rx&#x27;</span>, <span class="hljs-number">5</span>)
        .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;ry&#x27;</span>, <span class="hljs-number">5</span>)
        .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;width&#x27;</span>, width + <span class="hljs-number">20</span>)
        .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;height&#x27;</span>, (height - <span class="hljs-number">70</span>) / <span class="hljs-number">3</span>);

      data.<span class="hljs-property">time</span> = data.<span class="hljs-property">time</span>.<span class="hljs-title function_">map</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) { <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(t.<span class="hljs-title function_">valueOf</span>()); });
      <span class="hljs-keyword">var</span> x = d3.<span class="hljs-title function_">scaleTime</span>().<span class="hljs-title function_">nice</span>(<span class="hljs-number">4</span>)
        .<span class="hljs-title function_">domain</span>(d3.<span class="hljs-title function_">extent</span>(data.<span class="hljs-property">time</span>))
        .<span class="hljs-title function_">range</span>([<span class="hljs-number">50</span>, width]);
      <span class="hljs-keyword">var</span> y = d3.<span class="hljs-title function_">scaleLinear</span>().<span class="hljs-title function_">nice</span>(<span class="hljs-number">5</span>)
        .<span class="hljs-title function_">domain</span>(d3.<span class="hljs-title function_">extent</span>(data.<span class="hljs-property">time</span>, f))
        .<span class="hljs-title function_">range</span>([height / <span class="hljs-number">3</span> - <span class="hljs-number">50</span>, <span class="hljs-number">36</span>]);

      <span class="hljs-keyword">var</span> xAxis = d3.<span class="hljs-title function_">axisBottom</span>(x).<span class="hljs-title function_">ticks</span>(<span class="hljs-number">4</span>);

      <span class="hljs-keyword">var</span> yAxis = d3.<span class="hljs-title function_">axisLeft</span>(y).<span class="hljs-title function_">ticks</span>(<span class="hljs-number">5</span>);

      group.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;g&#x27;</span>)
        .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;class&#x27;</span>, <span class="hljs-string">&#x27;x axis&#x27;</span>)
        .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;transform&#x27;</span>, <span class="hljs-string">&#x27;translate(0,&#x27;</span> + y.<span class="hljs-title function_">range</span>()[<span class="hljs-number">0</span>] + <span class="hljs-string">&#x27;)&#x27;</span>)
        .<span class="hljs-title function_">call</span>(xAxis);

      group.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;g&#x27;</span>)
        .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;class&#x27;</span>, <span class="hljs-string">&#x27;y axis&#x27;</span>)
        .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;transform&#x27;</span>, <span class="hljs-string">&#x27;translate(&#x27;</span> + x.<span class="hljs-title function_">range</span>()[<span class="hljs-number">0</span>] + <span class="hljs-string">&#x27;)&#x27;</span>)
        .<span class="hljs-title function_">call</span>(yAxis);

      <span class="hljs-keyword">var</span> line = d3.<span class="hljs-title function_">line</span>()
        .<span class="hljs-title function_">x</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) { <span class="hljs-keyword">return</span> <span class="hljs-title function_">x</span>(d); })
        .<span class="hljs-title function_">y</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">d, j</span>) { <span class="hljs-keyword">return</span> <span class="hljs-title function_">y</span>(<span class="hljs-title function_">f</span>(d, j)); });

      group.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;path&#x27;</span>)
        .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;class&#x27;</span>, <span class="hljs-string">&#x27;plot-line&#x27;</span>)
        .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;d&#x27;</span>, <span class="hljs-title function_">line</span>(data.<span class="hljs-property">time</span>));

      group.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;text&#x27;</span>)
        .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;x&#x27;</span>, width / <span class="hljs-number">2</span> + <span class="hljs-number">10</span>)
        .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;y&#x27;</span>, <span class="hljs-string">&#x27;1em&#x27;</span>)
        .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;text-anchor&#x27;</span>, <span class="hljs-string">&#x27;middle&#x27;</span>)
        .<span class="hljs-title function_">text</span>(t);
    }

    group.<span class="hljs-title function_">selectAll</span>(<span class="hljs-string">&#x27;.app-plot&#x27;</span>).<span class="hljs-title function_">data</span>(d3.<span class="hljs-title function_">range</span>(<span class="hljs-number">3</span>)).<span class="hljs-title function_">enter</span>()
      .<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;g&#x27;</span>)
        .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;class&#x27;</span>, <span class="hljs-string">&#x27;app-plot&#x27;</span>)
        .<span class="hljs-title function_">each</span>(makePlot);

    <span class="hljs-keyword">return</span> data;
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">makeHistogram</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-keyword">var</span> margin = {<span class="hljs-attr">top</span>: <span class="hljs-number">45</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">30</span>};
    <span class="hljs-keyword">var</span> mapHeight = map.<span class="hljs-title function_">node</span>().<span class="hljs-title function_">height</span>() - <span class="hljs-number">15</span>;
    <span class="hljs-keyword">var</span> width = <span class="hljs-number">300</span>;
    <span class="hljs-keyword">var</span> height = <span class="hljs-number">100</span>;

    canvas = d3.<span class="hljs-title function_">select</span>(ui.<span class="hljs-title function_">canvas</span>()).<span class="hljs-title function_">select</span>(<span class="hljs-string">&#x27;svg.dynamic-content&#x27;</span>)
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;width&#x27;</span>, $(<span class="hljs-variable language_">window</span>).<span class="hljs-title function_">width</span>())
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;height&#x27;</span>, $(<span class="hljs-variable language_">window</span>).<span class="hljs-title function_">height</span>());

    canvas.<span class="hljs-title function_">selectAll</span>(<span class="hljs-string">&#x27;.app-histogram&#x27;</span>).<span class="hljs-title function_">remove</span>();
    <span class="hljs-keyword">var</span> group = canvas.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;g&#x27;</span>).<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;class&#x27;</span>, <span class="hljs-string">&#x27;app-histogram&#x27;</span>);

    <span class="hljs-keyword">var</span> x = d3.<span class="hljs-title function_">scaleLinear</span>()
      .<span class="hljs-title function_">domain</span>([-<span class="hljs-number">0.5</span>, <span class="hljs-number">5.5</span>])
      .<span class="hljs-title function_">range</span>([<span class="hljs-number">15</span> + margin.<span class="hljs-property">left</span>, <span class="hljs-number">15</span> + margin.<span class="hljs-property">left</span> + width]);

    <span class="hljs-keyword">var</span> cats = [];
    data.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) {
      d.<span class="hljs-property">pressure</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">p</span>) {
        cats.<span class="hljs-title function_">push</span>(<span class="hljs-title function_">category</span>(p));
      });
    });

    <span class="hljs-keyword">var</span> hist = d3.<span class="hljs-title function_">bin</span>().<span class="hljs-title function_">domain</span>(d3.<span class="hljs-title function_">extent</span>(cats)).<span class="hljs-title function_">thresholds</span>(d3.<span class="hljs-title function_">range</span>(<span class="hljs-number">7</span>))(cats);

    <span class="hljs-keyword">var</span> y = d3.<span class="hljs-title function_">scaleLinear</span>()
      .<span class="hljs-title function_">domain</span>([<span class="hljs-number">0</span>, d3.<span class="hljs-title function_">max</span>(hist, <span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) { <span class="hljs-keyword">return</span> d.<span class="hljs-property">length</span>; })])
      .<span class="hljs-title function_">range</span>([mapHeight - margin.<span class="hljs-property">bottom</span>, mapHeight - height - margin.<span class="hljs-property">bottom</span>]);

    <span class="hljs-keyword">var</span> xAxis = d3.<span class="hljs-title function_">axisBottom</span>(x)
      .<span class="hljs-title function_">tickValues</span>(d3.<span class="hljs-title function_">range</span>(<span class="hljs-number">6</span>))
      .<span class="hljs-title function_">tickFormat</span>(d3.<span class="hljs-title function_">format</span>(<span class="hljs-string">&#x27;.0f&#x27;</span>));

    group.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;rect&#x27;</span>)
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;class&#x27;</span>, <span class="hljs-string">&#x27;app-background&#x27;</span>)
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;rx&#x27;</span>, <span class="hljs-number">5</span>)
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;ry&#x27;</span>, <span class="hljs-number">5</span>)
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;x&#x27;</span>, x.<span class="hljs-title function_">range</span>()[<span class="hljs-number">0</span>] - margin.<span class="hljs-property">left</span>)
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;y&#x27;</span>, y.<span class="hljs-title function_">range</span>()[<span class="hljs-number">1</span>] - margin.<span class="hljs-property">top</span>)
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;width&#x27;</span>, width + margin.<span class="hljs-property">left</span> + margin.<span class="hljs-property">right</span>)
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;height&#x27;</span>, height + margin.<span class="hljs-property">bottom</span> + margin.<span class="hljs-property">top</span>);

    <span class="hljs-keyword">var</span> bar = group.<span class="hljs-title function_">selectAll</span>(<span class="hljs-string">&#x27;.bar&#x27;</span>)
        .<span class="hljs-title function_">data</span>(hist)
      .<span class="hljs-title function_">enter</span>().<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;g&#x27;</span>)
        .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;class&#x27;</span>, <span class="hljs-string">&#x27;bar&#x27;</span>)
        .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;transform&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) {
          <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;translate(&#x27;</span> + [<span class="hljs-title function_">x</span>(d.<span class="hljs-property">x0</span> - <span class="hljs-number">0.5</span>), <span class="hljs-number">0</span>] + <span class="hljs-string">&#x27;)&#x27;</span>;
        });

    bar.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;rect&#x27;</span>)
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;x&#x27;</span>, <span class="hljs-number">1</span>)
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;y&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) { <span class="hljs-keyword">return</span> <span class="hljs-title function_">y</span>(d.<span class="hljs-property">length</span>); })
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;width&#x27;</span>, <span class="hljs-title function_">x</span>(<span class="hljs-number">1</span>) - <span class="hljs-title function_">x</span>(<span class="hljs-number">0</span>) - <span class="hljs-number">2</span>)
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;height&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">y</span>(<span class="hljs-number">0</span>) - <span class="hljs-title function_">y</span>(d.<span class="hljs-property">length</span>);
      })
      .<span class="hljs-title function_">style</span>(<span class="hljs-string">&#x27;fill&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">cscale</span>(d.<span class="hljs-property">x0</span>);
      });

    bar.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;text&#x27;</span>)
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;dy&#x27;</span>, <span class="hljs-string">&#x27;0.75em&#x27;</span>)
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;y&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">y</span>(d.<span class="hljs-property">length</span>) - <span class="hljs-number">18</span>;
      })
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;x&#x27;</span>, (<span class="hljs-title function_">x</span>(<span class="hljs-number">1</span>) - <span class="hljs-title function_">x</span>(<span class="hljs-number">0</span>)) / <span class="hljs-number">2</span>)
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;text-anchor&#x27;</span>, <span class="hljs-string">&#x27;middle&#x27;</span>)
      .<span class="hljs-title function_">text</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) {
        <span class="hljs-keyword">return</span> d.<span class="hljs-property">length</span>;
      });

    group.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;g&#x27;</span>)
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;class&#x27;</span>, <span class="hljs-string">&#x27;x axis&#x27;</span>)
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;transform&#x27;</span>, <span class="hljs-string">&#x27;translate(&#x27;</span> + [<span class="hljs-number">0</span>, <span class="hljs-title function_">y</span>(<span class="hljs-number">0</span>)] + <span class="hljs-string">&#x27;)&#x27;</span>)
      .<span class="hljs-title function_">style</span>(<span class="hljs-string">&#x27;font-size&#x27;</span>, <span class="hljs-string">&#x27;unset&#x27;</span>)
      .<span class="hljs-title function_">call</span>(xAxis);

    group.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;text&#x27;</span>)
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;x&#x27;</span>, <span class="hljs-title function_">x</span>(<span class="hljs-number">2.5</span>))
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;y&#x27;</span>, y.<span class="hljs-title function_">range</span>()[<span class="hljs-number">1</span>] - margin.<span class="hljs-property">top</span>)
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;dy&#x27;</span>, <span class="hljs-string">&#x27;1em&#x27;</span>)
      .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;text-anchor&#x27;</span>, <span class="hljs-string">&#x27;middle&#x27;</span>)
      .<span class="hljs-title function_">text</span>(<span class="hljs-string">&#x27;All observations&#x27;</span>);
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-keyword">if</span> (data) {
      save = data;
    } <span class="hljs-keyword">else</span> {
      data = save;
    }
    data = data.<span class="hljs-title function_">filter</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">any</span>(d.<span class="hljs-property">pressure</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) { <span class="hljs-keyword">return</span> d &lt;= <span class="hljs-number">0</span>; })) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      }

      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">all</span>(d.<span class="hljs-property">pressure</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) { <span class="hljs-keyword">return</span> <span class="hljs-title function_">category</span>(d) === <span class="hljs-number">0</span>; })) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      }
      <span class="hljs-keyword">return</span> d.<span class="hljs-property">basin</span> === <span class="hljs-string">&#x27;North Atlantic&#x27;</span>;
    });

    <span class="hljs-title function_">makeHistogram</span>(data);

    feature.<span class="hljs-title function_">data</span>(data)
      .<span class="hljs-title function_">line</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) {
        <span class="hljs-keyword">return</span> d3.<span class="hljs-title function_">range</span>(d.<span class="hljs-property">time</span>.<span class="hljs-property">length</span>).<span class="hljs-title function_">map</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">i</span>) {
          <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">x</span>: d.<span class="hljs-property">longitude</span>[i],
            <span class="hljs-attr">y</span>: d.<span class="hljs-property">latitude</span>[i],
            <span class="hljs-attr">t</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(d.<span class="hljs-property">time</span>[i]),
            <span class="hljs-attr">w</span>: d.<span class="hljs-property">wind</span>[i],
            <span class="hljs-attr">p</span>: d.<span class="hljs-property">pressure</span>[i],
            <span class="hljs-attr">d</span>: d.<span class="hljs-property">dist2land</span>[i],
            <span class="hljs-attr">c</span>: <span class="hljs-title function_">category</span>(d.<span class="hljs-property">pressure</span>[i])
          };
        });
      })
      .<span class="hljs-title function_">position</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) {
        <span class="hljs-keyword">return</span> d;
      })
      .<span class="hljs-title function_">style</span>({
        <span class="hljs-attr">strokeColor</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) {
          <span class="hljs-keyword">if</span> (query.<span class="hljs-property">scale</span> === <span class="hljs-string">&#x27;false&#x27;</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-title function_">cscale</span>(<span class="hljs-number">0</span>);
          }
          <span class="hljs-keyword">return</span> <span class="hljs-title function_">cscale</span>(d.<span class="hljs-property">c</span>);
        },
        <span class="hljs-attr">strokeWidth</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">d, i, l, pos</span>) {
          <span class="hljs-keyword">var</span> width = <span class="hljs-number">1.5</span>;
          <span class="hljs-keyword">if</span> (query.<span class="hljs-property">width</span> === <span class="hljs-string">&#x27;speed&#x27;</span>) {
            width = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">1.5</span>, d.<span class="hljs-property">w</span> / <span class="hljs-number">20</span>);
          }
          <span class="hljs-keyword">if</span> (data[pos].<span class="hljs-property">hover</span>) {
            width += <span class="hljs-number">3.5</span>;
          }
          <span class="hljs-keyword">return</span> width;
        },
        <span class="hljs-attr">strokeOpacity</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">d, i, l, pos</span>) {
          <span class="hljs-keyword">if</span> (data[pos].<span class="hljs-property">hover</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
          }
          <span class="hljs-keyword">if</span> (query.<span class="hljs-property">opacity</span> === <span class="hljs-string">&#x27;false&#x27;</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-number">0.50</span>;
          }
          <span class="hljs-keyword">if</span> (d.<span class="hljs-property">c</span> === <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-number">0.25</span>;
          }
          <span class="hljs-keyword">return</span> <span class="hljs-number">0.25</span> + <span class="hljs-number">0.5</span> * (d.<span class="hljs-property">t</span> - start) / drange;
        },
        <span class="hljs-attr">lineCap</span>: query.<span class="hljs-property">smooth</span> === <span class="hljs-string">&#x27;true&#x27;</span> ? <span class="hljs-string">&#x27;round&#x27;</span> : <span class="hljs-literal">undefined</span>,
        <span class="hljs-attr">lineJoin</span>: query.<span class="hljs-property">smooth</span> === <span class="hljs-string">&#x27;true&#x27;</span> ? <span class="hljs-string">&#x27;round&#x27;</span> : <span class="hljs-literal">undefined</span>
      })
      .<span class="hljs-title function_">geoOff</span>(geo.<span class="hljs-property">event</span>.<span class="hljs-property">feature</span>.<span class="hljs-property">mouseover</span>)
      .<span class="hljs-title function_">geoOff</span>(geo.<span class="hljs-property">event</span>.<span class="hljs-property">feature</span>.<span class="hljs-property">mouseout</span>)
      .<span class="hljs-title function_">geoOn</span>(geo.<span class="hljs-property">event</span>.<span class="hljs-property">feature</span>.<span class="hljs-property">mouseover</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">evt</span>) {
        <span class="hljs-keyword">if</span> (query.<span class="hljs-property">hover</span> === <span class="hljs-string">&#x27;false&#x27;</span>) {
          <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">if</span> (!evt.<span class="hljs-property">top</span>) { <span class="hljs-keyword">return</span>; }
        data.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) {
          d.<span class="hljs-property">hover</span> = <span class="hljs-literal">false</span>;
        });
        evt.<span class="hljs-property">data</span>.<span class="hljs-property">hover</span> = <span class="hljs-literal">true</span>;
        <span class="hljs-title function_">makeInfoBox</span>(evt.<span class="hljs-property">data</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">modified</span>();
        feature.<span class="hljs-title function_">draw</span>();
      });
    feature.<span class="hljs-title function_">draw</span>();
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-4">&#x00a7;</a>
              </div>
              <p>Create a map object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  map = geo.<span class="hljs-title function_">map</span>({
    <span class="hljs-attr">node</span>: <span class="hljs-string">&#x27;#map&#x27;</span>,
    <span class="hljs-attr">center</span>: {
      <span class="hljs-attr">x</span>: query.<span class="hljs-property">x</span> ? +query.<span class="hljs-property">x</span> : -<span class="hljs-number">50</span>,
      <span class="hljs-attr">y</span>: query.<span class="hljs-property">y</span> ? +query.<span class="hljs-property">y</span> : <span class="hljs-number">30</span>
    },
    <span class="hljs-attr">zoom</span>: query.<span class="hljs-property">zoom</span> ? +query.<span class="hljs-property">zoom</span> : <span class="hljs-number">4</span>
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-5">&#x00a7;</a>
              </div>
              <p>Add the default osm layer</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  map.<span class="hljs-title function_">createLayer</span>(<span class="hljs-string">&#x27;osm&#x27;</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-6">&#x00a7;</a>
              </div>
              <p>Create a feature layer to draw on.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  layer = map.<span class="hljs-title function_">createLayer</span>(<span class="hljs-string">&#x27;feature&#x27;</span>, {<span class="hljs-attr">features</span>: [geo.<span class="hljs-property">lineFeature</span>.<span class="hljs-property">capabilities</span>.<span class="hljs-property">multicolor</span>]});</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-7">&#x00a7;</a>
              </div>
              <p>Create a line feature</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  feature = layer.<span class="hljs-title function_">createFeature</span>(<span class="hljs-string">&#x27;line&#x27;</span>, {<span class="hljs-attr">selectionAPI</span>: <span class="hljs-literal">true</span>});</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-8">&#x00a7;</a>
              </div>
              <p>Create a legend</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  ui = map.<span class="hljs-title function_">createLayer</span>(<span class="hljs-string">&#x27;ui&#x27;</span>);
  ui = map.<span class="hljs-title function_">createLayer</span>(<span class="hljs-string">&#x27;ui&#x27;</span>);
  <span class="hljs-keyword">var</span> legend = [];
  <span class="hljs-keyword">if</span> (query.<span class="hljs-property">scale</span> !== <span class="hljs-string">&#x27;false&#x27;</span>) {
    legend = legend.<span class="hljs-title function_">concat</span>([{
      <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Category 5&#x27;</span>,
      <span class="hljs-attr">style</span>: {
        <span class="hljs-attr">strokeColor</span>: <span class="hljs-title function_">cscale</span>(<span class="hljs-number">5</span>),
        <span class="hljs-attr">strokeWidth</span>: <span class="hljs-number">3</span>
      },
      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;line&#x27;</span>
    }, {
      <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Category 4&#x27;</span>,
      <span class="hljs-attr">style</span>: {
        <span class="hljs-attr">strokeColor</span>: <span class="hljs-title function_">cscale</span>(<span class="hljs-number">4</span>),
        <span class="hljs-attr">strokeWidth</span>: <span class="hljs-number">3</span>
      },
      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;line&#x27;</span>
    }, {
      <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Category 3&#x27;</span>,
      <span class="hljs-attr">style</span>: {
        <span class="hljs-attr">strokeColor</span>: <span class="hljs-title function_">cscale</span>(<span class="hljs-number">3</span>),
        <span class="hljs-attr">strokeWidth</span>: <span class="hljs-number">3</span>
      },
      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;line&#x27;</span>
    }, {
      <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Category 2&#x27;</span>,
      <span class="hljs-attr">style</span>: {
        <span class="hljs-attr">strokeColor</span>: <span class="hljs-title function_">cscale</span>(<span class="hljs-number">2</span>),
        <span class="hljs-attr">strokeWidth</span>: <span class="hljs-number">3</span>
      },
      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;line&#x27;</span>
    }, {
      <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Category 1&#x27;</span>,
      <span class="hljs-attr">style</span>: {
        <span class="hljs-attr">strokeColor</span>: <span class="hljs-title function_">cscale</span>(<span class="hljs-number">1</span>),
        <span class="hljs-attr">strokeWidth</span>: <span class="hljs-number">3</span>
      },
      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;line&#x27;</span>
    }, {
      <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Other&#x27;</span>,
      <span class="hljs-attr">style</span>: {
        <span class="hljs-attr">strokeColor</span>: <span class="hljs-title function_">cscale</span>(<span class="hljs-number">0</span>),
        <span class="hljs-attr">strokeWidth</span>: <span class="hljs-number">3</span>
      },
      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;line&#x27;</span>
    }]);
  }
  <span class="hljs-keyword">if</span> (query.<span class="hljs-property">width</span> === <span class="hljs-string">&#x27;speed&#x27;</span>) {
    legend = legend.<span class="hljs-title function_">concat</span>([{
      <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;&lt;30 knots&#x27;</span>,
      <span class="hljs-attr">style</span>: {
        <span class="hljs-attr">strokeColor</span>: <span class="hljs-string">&#x27;black&#x27;</span>,
        <span class="hljs-attr">strokeWidth</span>: <span class="hljs-number">1.5</span>
      },
      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;line&#x27;</span>
    }, {
      <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;60 knots&#x27;</span>,
      <span class="hljs-attr">style</span>: {
        <span class="hljs-attr">strokeColor</span>: <span class="hljs-string">&#x27;black&#x27;</span>,
        <span class="hljs-attr">strokeWidth</span>: <span class="hljs-number">3</span>
      },
      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;line&#x27;</span>
    }, {
      <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;110 knots&#x27;</span>,
      <span class="hljs-attr">style</span>: {
        <span class="hljs-attr">strokeColor</span>: <span class="hljs-string">&#x27;black&#x27;</span>,
        <span class="hljs-attr">strokeWidth</span>: <span class="hljs-number">5.5</span>
      },
      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;line&#x27;</span>
    }, {
      <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;160 knots&#x27;</span>,
      <span class="hljs-attr">style</span>: {
        <span class="hljs-attr">strokeColor</span>: <span class="hljs-string">&#x27;black&#x27;</span>,
        <span class="hljs-attr">strokeWidth</span>: <span class="hljs-number">8</span>
      },
      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;line&#x27;</span>
    }]);
  }
  <span class="hljs-keyword">if</span> (legend.<span class="hljs-property">length</span>) {
    ui.<span class="hljs-title function_">createWidget</span>(<span class="hljs-string">&#x27;legend&#x27;</span>, {<span class="hljs-attr">position</span>: {<span class="hljs-attr">right</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">top</span>: <span class="hljs-number">10</span>}})
      .<span class="hljs-title function_">categories</span>(legend);
  }

  canvas = d3.<span class="hljs-title function_">select</span>(ui.<span class="hljs-title function_">canvas</span>()).<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;svg&#x27;</span>)
    .<span class="hljs-title function_">attr</span>(<span class="hljs-string">&#x27;class&#x27;</span>, <span class="hljs-string">&#x27;dynamic-content&#x27;</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-9">&#x00a7;</a>
              </div>
              <p>Load the data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  $.<span class="hljs-title function_">ajax</span>({
    <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;../../data/hurricanes.json&#x27;</span>,
    <span class="hljs-attr">success</span>: draw
  });

  $(<span class="hljs-variable language_">window</span>).<span class="hljs-title function_">resize</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
    <span class="hljs-title function_">draw</span>();
    <span class="hljs-title function_">makeInfoBox</span>();
  });
});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
